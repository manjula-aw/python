import requests as req
from bs4 import BeautifulSoup
import re
import time


inputfile="cve-list.txt"
outputfile="cve-details-2n3.txt"

cvepattern = re.compile(r"(CVE-\d{4}-\d+)");


with open(outputfile, 'w') as f:
    with open(inputfile) as fp:  
       for cnt, cve in enumerate(fp):
            cve = cve.strip();
            print(cve)
            page = req.get("https://services.nvd.nist.gov/rest/json/cve/1.0/{}".format(cve))

            html_status = page.status_code

            try:
                if int(html_status) == 200:
                    json_res = page.json()
                    cpename = json_res["result"]["CVE_Items"][0]["configurations"]["nodes"][0]["cpe_match"][0]["cpe23Uri"]
                    cvssscore = json_res["result"]["CVE_Items"][0]["impact"]["baseMetricV2"]["cvssV2"]["baseScore"]
                    cvss3score = json_res["result"]["CVE_Items"][0]["impact"]["baseMetricV3"]["cvssV3"]["baseScore"]
                    vectorString = json_res["result"]["CVE_Items"][0]["impact"]["baseMetricV2"]["cvssV2"]["vectorString"]
                    f.write("{}\n".format("{}, {}, {}, {}, {}".format(cve, cvssscore, cvss3score, vectorString, cpename)))
                else:
                    print("Error in connection or wrong URL")
            except Exception as e:
                print(str(html_status) + ' : ' + str(e)) 
                
            time.sleep(5)
            
print("Finished writing CVE details to file '{}'.".format(outputfile))