import requests as req
import re
from bs4 import BeautifulSoup

inputfile="nessus-plugin-id-list.txt"
outputfile="cve-details.txt"

cveidlist=[];
cvedetails=[];
cvepattern = re.compile(r"(CVE-\d{4}-\d+)");

with open(inputfile) as fp:  
   for cnt, nessusid in enumerate(fp):
       nessusid=nessusid.strip();
       resp = req.get("https://www.tenable.com/plugins/nessus/{}".format(nessusid))
       m = cvepattern.findall(resp.text)
       if (m is not None):
           cveidlist.extend(m);

unique_cve_ids=set(cveidlist)

print("Found CVE List for given nessus plugin ids: {}".format(unique_cve_ids))

with open(outputfile, 'w') as f:
    for cve in unique_cve_ids:
        resp = req.get("https://nvd.nist.gov/vuln/detail/{}".format(cve))
        soup = BeautifulSoup(resp.text, "html.parser")
        cvss2score = soup.find(attrs={"data-testid": "vuln-cvssv2-base-score"}).string.strip()
        cvss2scorestring = soup.find(attrs={"data-testid": "vuln-cvssv2-base-score-severity"}).string.strip()
        f.write("{}\n".format("{}, {}, {}".format(cve, cvss2score, cvss2scorestring)))

print("Finished writing CVE details to file '{}'.".format(outputfile))
